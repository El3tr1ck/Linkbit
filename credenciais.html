<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LinkBit - Credenciais</title>
    <style>
        body {
            background: linear-gradient(135deg, #f0f4ff, #e6e9ff);
            font-family: 'Arial', sans-serif;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .credentials-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            padding: 30px;
            max-width: 400px;
            width: 100%;
            text-align: center;
        }

        h1 {
            color: #6e8efb;
            margin-bottom: 20px;
            font-size: 24px;
        }

        .info-section {
            margin-bottom: 20px;
        }

        .info-section p {
            margin: 10px 0;
            color: #333;
            font-size: 16px;
        }

        .password-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        #password {
            color: #333;
            font-size: 16px;
            background: #f9f9f9;
            padding: 5px 10px;
            border-radius: 5px;
        }

        .toggle-password {
            padding: 8px 12px;
            background: #6e8efb;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }

        .toggle-password:hover {
            background: #a777e3;
        }

        .current-picture {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid #6e8efb;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            color: white;
            text-transform: uppercase;
        }

        form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        input[type="text"],
        input[type="file"] {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
        }

        input[type="text"]:focus {
            border-color: #6e8efb;
            outline: none;
        }

        button[type="submit"] {
            padding: 10px;
            background: linear-gradient(135deg, #6e8efb, #a777e3);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        button[type="submit"]:hover {
            transform: translateY(-2px);
        }

        #error-message {
            color: red;
            font-size: 14px;
            margin-top: 10px;
        }

        @media (max-width: 600px) {
            .credentials-container {
                padding: 20px;
            }

            h1 {
                font-size: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="credentials-container">
        <h1>Suas Credenciais</h1>
        <div class="info-section">
            <img id="current-picture" src="https://via.placeholder.com/100" alt="Foto Atual">
            <p><strong>Nome:</strong> <span id="current-name">Nome Atual</span></p>
            <p id="email-section" style="display: none;"><strong>Email:</strong> <span id="current-email">Email Atual</span></p>
            <div id="password-section" class="password-container" style="display: none;">
                <p><strong>Senha:</strong> <span id="password">******</span></p>
                <button class="toggle-password" onclick="togglePassword()">Mostrar</button>
            </div>
        </div>
        <form id="credentials-form">
            <input type="text" id="display-name" placeholder="Novo nome de usuário">
            <input type="file" id="photo-upload" accept="image/*">
            <button type="submit">Salvar Alterações</button>
        </form>
        <p id="error-message" style="display: none;"></p>
    </div>

    <script>
        // Função para gerar cor aleatória (consistente por nome)
        function getAvatarColor(name) {
            const colors = ['#6e8efb', '#a777e3', '#ff6b6b', '#4CAF50', '#FF9800', '#9C27B0'];
            let hash = 0;
            for (let i = 0; i < name.length; i++) {
                hash = name.charCodeAt(i) + ((hash << 5) - hash);
            }
            return colors[Math.abs(hash) % colors.length];
        }

        // Função para carregar informações do usuário
        function loadUserInfo() {
            const user = JSON.parse(localStorage.getItem('user') || '{}');
            const display = JSON.parse(localStorage.getItem('display') || '{}');
            const currentName = document.getElementById('current-name');
            const currentEmail = document.getElementById('current-email');
            const password = document.getElementById('password');
            const emailSection = document.getElementById('email-section');
            const passwordSection = document.getElementById('password-section');
            const currentPicture = document.getElementById('current-picture');
            const displayNameInput = document.getElementById('display-name');

            // Define nome
            const name = display.name || user.name || 'Amigo';
            if (currentName) {
                currentName.textContent = name;
            }
            if (displayNameInput) {
                displayNameInput.value = name;
            }

            // Configura para formulário
            if (user.type === 'form') {
                if (currentEmail) {
                    currentEmail.textContent = user.email || 'N/A';
                    emailSection.style.display = 'block';
                }
                if (password) {
                    password.textContent = user.password ? '******' : 'N/A';
                    password.dataset.value = user.password || '';
                    passwordSection.style.display = 'block';
                }
            }

            // Configura foto ou avatar
            if (display.picture) {
                currentPicture.src = display.picture;
                currentPicture.style.background = 'none';
                currentPicture.textContent = '';
            } else if (user.picture && user.type === 'google') {
                currentPicture.src = user.picture;
                currentPicture.style.background = 'none';
                currentPicture.textContent = '';
            } else {
                currentPicture.src = '';
                currentPicture.style.background = getAvatarColor(name);
                currentPicture.textContent = name.charAt(0);
            }
        }

        // Função para mostrar/esconder senha
        function togglePassword() {
            const password = document.getElementById('password');
            const button = document.querySelector('.toggle-password');
            if (password.textContent === '******') {
                password.textContent = password.dataset.value;
                button.textContent = 'Esconder';
            } else {
                password.textContent = '******';
                button.textContent = 'Mostrar';
            }
        }

        // Função para salvar alterações visuais
        document.getElementById('credentials-form').addEventListener('submit', function (e) {
            e.preventDefault();
            const user = JSON.parse(localStorage.getItem('user') || '{}');
            const displayName = document.getElementById('display-name').value;
            const photoFile = document.getElementById('photo-upload').files[0];
            const errorMessage = document.getElementById('error-message');

            // Valida nome para formulário
            if (user.type === 'form' && !displayName) {
                errorMessage.textContent = 'O nome não pode ser vazio!';
                errorMessage.style.display = 'block';
                return;
            }

            // Processa foto
            let picture = JSON.parse(localStorage.getItem('display') || '{}').picture || user.picture;
            if (photoFile) {
                const reader = new FileReader();
                reader.onload = function (event) {
                    picture = event.target.result;
                    saveDisplay(displayName, picture);
                };
                reader.readAsDataURL(photoFile);
            } else {
                saveDisplay(displayName, picture);
            }
        });

        // Função para salvar display
        function saveDisplay(name, picture) {
            const user = JSON.parse(localStorage.getItem('user') || '{}');
            const display = {
                name: name || user.name || 'Amigo',
                picture: picture || null
            };
            localStorage.setItem('display', JSON.stringify(display));
            loadUserInfo();
            window.location.reload();
        }

        // Verifica autenticação
        function checkAuth() {
            const user = JSON.parse(localStorage.getItem('user') || '{}');
            if (!user || !user.name) {
                window.location.href = 'login.html';
                return;
            }
            loadUserInfo();
        }

        document.addEventListener('DOMContentLoaded', checkAuth);
    </script>
</body>
</html>
